# Styles

This section describes how stylesheets are handled within Lyvely modules and applications. 

To build a web module package, you can execute the following command within the root of your project:

```shell
npm build -w my-module-web
```

or when using nx:

```shell
nx run my-module-web:build
```

## Module Styles

Lyvely utilizes [tailwindcss](https://tailwindcss.com/) for styling components and views. 
When building a module's web package, it generates the following resources related to styling:

- `tailwind.css`: This file includes all tailwind styles used by your module. 
Typically, it's only used in the module's development and end-to-end (e2e) environments.
- `tailwind.txt`: This file includes all tailwind selectors extracted from `tailwind.css`.
Consuming modules or applications use these files for scanning for dependent tailwind selectors.
- `styles.css`: (optional) This file contains custom classes defined in `<style>` blocks within your components and 
imported styles. These styles are exported by the modules `package.json` and must be imported by consuming applications. 


:::info
We have chosen this separation to avoid issues that can arise from including multiple tailwind builds within a single 
application. The order of tailwind selectors is crucial, and mixing them can lead to one import overwriting and 
disrupting the order of selectors from another import.
:::

:::note
The tailwind style handling can (hopefully) be simplified once 
[Tailwind v4](https://tailwindcss.com/blog/tailwindcss-v4-alpha) is out.
:::

## Consuming Module Styles

### Including Dependent Tailwind Selectors

To ensure that our consuming module or application includes all dependent tailwind selectors used by dependent modules, 
you must add the `tailwind.txt` file to the `tailwind.config.cjs` file of the consuming module or application, as shown below:

```javascript title=tailwind.config.cjs
const baseConfig = require('@lyvely/devtools/tailwind/tailwind.config');

module.exports = {
    ...baseConfig,
    content: [
        ...baseConfig.content,
        // Here we include core tailwind selectors required for the development and e2e environment.
        require.resolve('@lyvely/ui/tailwind.txt'),
        require.resolve('@lyvely/web/tailwind.txt'),
        // Here we make sure our dependent tailwind selectors are recognized and included.
        require.resolve('@lyvely/some-dependency-web/tailwind.txt'),
    ]
};
```

:::info
The `tailwind.config.cjs` is used to generate the `tailwind.txt` file for consumption by other modules or applications 
as well as `tailwind.css` which is used in test environments.
:::

### Export of `style.css` and `tailwind.txt`


If the consumed module exports a `style.css` file, the module or application that consumes it is responsible for 
importing the style. Your `package.json` file should export the `style.css` (if any) and `tailwind.txt` files as follows:

```json title=package.json
{
  "name": "my-module-web",
  "version": "1.0.0",
  "exports": {
    ".": {
      "import": "./dist/index.js",
      "require": "./dist/index.js"
    },
    "./style.css": {
      "import": "./dist/style.css",
      "require": "./dist/style.css"
    },
    "./tailwind.txt": {
      "import": "./dist/tailwind.txt",
      "require": "./dist/tailwind.txt"
    }
  }
}
```

:::warning
Whenever possible, it is recommended to use tailwind's utility classes or leverage core or UI components instead of
generating custom styles. This facilitates the consumption of your module and corresponds to the basic philosophy 
of tailwindcss.
:::

## How this works

Even though you do not have to care about the internals of the build process in most cases, especially when using a
module template, the following section explains how the build process of a web package generates the previously discussed
files which may be helpful when debugging style related issues.

- Running the `npm build` command of your web package will internally run the `lyvely-dev build:web` command which is
responsible for compiling the sources and generating `tailwind.css`, `tailwind.txt` and `style.css` files within the `dist` directory.
- The `dist/tailwind.css` is internally generated by running `postcss` against the `style/tailwind.css` file within your modules `src`
directory.
- The `postcss` command will use the `tailwind.config.cjs` to configure the tailwind postcss plugin which
is responsible for scanning all used and dependant tailwind classes and include them into the `dist/tailwind.css`. 
- The build command then extracts and unescapes all selectors from the `dist/tailwind.css` file and includes them into the `dist/tailwind.txt` file.
- When running `vite` to start a test server it will include the `src/style/tailwind.css` file and all dependent 
`style.css` files from other modules imported by `maint.ts`.
- When running the vite build for other environments (e.g `npm build`) it ignores the `main.ts` and the
`src/style/tailwind.css` file, in order to prevent the inclusion of tailwind into the `dist/style.css`. 
This is done by using the following `vite.config.mts`:

```javascript title=vite.config.ts
import { useViteWebConfig } from '@lyvely/devtools'
import { defineConfig } from "vite";

export default defineConfig(useViteWebConfig({ dirname: __dirname }));
```

- The `postcss.config.cjs` can be imported by the `@lyvely/devoolts` package:

```javascript title=postcss.config.cjs
const postCssConfig = require('@lyvely/devtools/tailwind/postcss.config.cjs');

module.exports = postCssConfig;
```

The `main.ts` is used to run a test environment and needs to include all dependent styles and the `style/tailwind.css`:

```javascript title=main.ts
import 'reflect-metadata';

import './styles/tailwind.css';
import '@lyvely/ui/style.css';
import '@lyvely/web/style.css';
import '@lyvely/some-dependency-web/style.css';

import { LyvelyWebApp } from '@lyvely/web';
import myModule from './module';

new LyvelyWebApp({
  modules: [myModule()],
})
  .init('#app')
  .catch((err) => console.error(err));
```

:::note
The process of importing of the `tailwind.txt` and `style.css` files of dependent modules may be automated 
in a future version of the platform.
:::

:::info
Please refer to the following resources for more information about the general build process:

- [tailwindcss Content configuration](https://tailwindcss.com/docs/configuration#content)
- [vite documentation](https://vitejs.dev/guide/)
:::
